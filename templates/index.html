<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:title" content="{창} 익명 방명록"/>
    <meta property="og:description" content="솔직한 의견을 가감없이 표출해보세요!"/>
    <meta property="og:image"
          content="https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F74eaf902-b158-444e-8348-c92edd20d043%2FMask_group_(3).png&blockId=4c4b7636-3a3f-4333-8e38-b30fa20b5f91&width=3600"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/f3e69e304d.js" crossorigin="anonymous"></script>
    <title>블라인드 {창}</title>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&display=swap"
          rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Serif KR', serif;
        }

        .mypic {
            width: 100%;
            height: 300px;

            background-image: linear-gradient(0deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)), url('https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F74eaf902-b158-444e-8348-c92edd20d043%2FMask_group_(3).png&blockId=4c4b7636-3a3f-4333-8e38-b30fa20b5f91&width=3600');
            background-position: center 30%;
            background-size: cover;

            color: white;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .mypost {
            width: 100%;
            max-width: 600px;
            margin: 20px auto 20px auto;

            box-shadow: 0px 0px 3px 0px black;
            padding: 20px;
        }

        .popular-post {
            width: 100%;
            max-width: 600px;
            margin: 20px auto 20px auto;

            box-shadow: 0px 0px 3px 0px black;
            padding: 20px;
        }

        .popular-post-title {
            text-align: center;
            font-weight: bold;
        }

        .lottery {
            width: 100%;
            max-width: 600px;
            margin: auto auto 20px auto;

            box-shadow: 0px 0px 3px 0px black;
            padding: 20px 20px 30px 20px;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .lottery-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .lottery-img {
            font-size: 60px;
        }

        .lottery-body {
            margin: 10px auto 30px auto;
            text-align: center;
        }

        .advertise {
            margin-top: 20px;
        }

        .mypost > button {
            margin-top: 15px;
        }

        .mycards {
            width: 100%;
            max-width: 600px;
            margin: auto;
        }

        .mycards > .card {
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>
    <script>
        $(document).ready(function () {
            set_num()
            show_content(1)
        });

        function randomIntFromInterval(min, max) { // min and max included
            return Math.floor(Math.random() * (max - min + 1) + min)
        }

        function set_num() {
            $('#temp').text(randomIntFromInterval(3, 8));
        }

        function save_post() {
            let nick_name = $('#name').val();
            let content = $('#content').val();
            $.ajax({
                type: 'POST',
                url: '/blind',
                data: {
                    nick_name: nick_name,
                    content: content
                },
                success: function (response) {
                    alert(response['msg'])
                    window.location.reload()
                }
            })
        }

        function range(start, stop) {
            var a = [start], b = start;
            while (b < stop) {
                a.push(b += 1);
            }
            return a;
        }

        function show_content(page_num) {
            $.ajax({
                type: "GET",
                url: `/blind?page=${page_num}`,
                data: {},
                success: function (response) {
                    $('#post-list').empty();
                    $('#button-list').empty();
                    let rows = response['posts']
                    let current_page = page_num;
                    let total_pages = Math.ceil(response['post_num'] / 5);
                    let window = 3

                    let start = current_page - window
                    let end = current_page + window

                    if (start <= 0) {
                        end = end - start + 1;
                        start = 1;
                    }
                    if (end > total_pages) {
                        end = total_pages;
                        start = Math.max(end - (window * 2) + 1, 1)
                    }

                    let buttons = range(start, end)
                    console.log(buttons)

                    let previous_disabled = ""
                    let next_disabled = ""
                    console.log(total_pages, page_num)

                    if (current_page === 1) {
                        previous_disabled = "disabled"
                    }
                    if (current_page === total_pages) {
                        next_disabled = "disabled"
                    }
                    let first_button = `
                        <li class="page-item ${previous_disabled}"><a class="page-link" href="javascript:show_content(${current_page - 1})" tabindex="-1"><</a>
                    </li>`

                    let last_button = `
                        <li class="page-item ${next_disabled}"><a class="page-link" href="javascript:show_content(${current_page + 1})" tabindex="-1">></a>
                    </li>
                    `
                    $('#button-list').append(first_button)
                    // 앞부분
                    for (let i = 0; i < buttons.length; i++) {
                        let button_num = buttons[i]
                        let active = ""
                        if (button_num === current_page) {
                            active = "active"
                        }
                        let button_html = `
                            <li class="page-item ${active}"><a class="page-link" href="javascript:show_content(${button_num})">${button_num}</a></li>
                        `
                        $('#button-list').append(button_html)
                    }
                    $('#button-list').append(last_button)

                    for (let i = 0; i < rows.length; i++) {
                        let nick_name = rows[i]['nick_name'];
                        let content = rows[i]['content'];
                        let temp_html = `
                        <div class="card">
                            <div class="card-body">
                              <h5 class="card-title">제곧내</h5>
                              <p class="card-text">${content}</p>
                              <p class="card-text"><small class="text-muted">3분전</small></p>
                            </div>
                            <div class="card-footer">
                              <div class="container">
                              <div class="row">
                              <div class="col-md-4 d-flex justify-content-center">
                                <i class="fa-regular fa-heart"><small class="text-muted"> 좋아요 </small></i>
                                </div>
                                <div class="col-md-4 d-flex justify-content-center">
                                <i class="fa-regular fa-comment"><small class="text-muted"> 13 </small></i>
                                </div>
                                <div class="col-md-4 d-flex justify-content-center">
                                <i class="fa fa-eye"><small class="text-muted"> 3 </small></i>
                                </div>
                                </div>
                                </div>
                            </div>


                           <!-- <div class="card-body">
                                <blockquote class="blockquote mb-0">
                                    <p>${content}</p>
                                    <footer class="blockquote-footer">${nick_name}</footer>
                                </blockquote>
                            </div>-->
                        </div>`
                        $('#post-list').append(temp_html);
                    }
                }
            });
        }
    </script>
</head>
<body>
<div class="mypic">
    <h1>블라인드 {창}</h1>
    <p>현재 접속 인원: <span id="temp">36</span>명</p>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <div class="row">
                <div class="card advertise" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">Special title treatment</h5>
                        <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                        <a href="#" class="btn btn-primary">Go somewhere</a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="card advertise" style="width: 18rem;">
                    <img class="card-img-top" src="/static/100억.png" alt="광고">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This card has supporting text below as a natural lead-in to additional
                            content.</p>
                        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mypost">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="name" placeholder="url">
                    <label for="name">닉네임</label>
                </div>
                <div class="form-floating">
        <textarea class="form-control" placeholder="Leave a comment here" id="content"
                  style="height: 100px"></textarea>
                    <label for="content">솔직한 의견을 남겨주세요!</label>
                </div>
                <button onclick="save_post()" type="button" class="btn btn-dark">마음의 소리 입력</button>
            </div>
            <div class="mycards" id="post-list">
                <!-- 댓글 삽입 -->
            </div>
        </div>
        <div class="col-md-3">
            <div class="row">
                <div class="popular-post">
                    <div class="popular-post-title">
                        <p>실시간 인기글 Top 5</p>
                    </div>
                    <ol class="list-group list-group-numbered">
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                창 솔직히 어떰?
                            </div>
                            <span class="badge bg-primary rounded-pill">10</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                200만원 가치 있나?
                            </div>
                            <span class="badge bg-primary rounded-pill">6</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                19조 아이템 좋은듯
                            </div>
                            <span class="badge bg-primary rounded-pill">1</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                팀원 모집합니다
                            </div>
                            <span class="badge bg-primary rounded-pill">2</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                김밥 좀 그만주세요
                            </div>
                            <span class="badge bg-primary rounded-pill">9</span>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="row">
                <div class="lottery">
                    <div class="lottery-title">
                        행운을 뽑아보세요
                    </div>
                    <div class="lottery-img">
                        🎁
                    </div>
                    <div class="lottery-body">
                        스타벅스 기프티콘이<br>
                        10개 남았어요
                    </div>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#luckyBox">눌러보세요</button>
                </div>
            </div>
        </div>
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center" id="button-list">

            </ul>
        </nav>

    </div>
</div>

<!-- Lucky Box Modal -->
<div class="modal fade" id="luckyBox" tabindex="-1" aria-labelledby="luckyBoxLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="luckyBoxLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>